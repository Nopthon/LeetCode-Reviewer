<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode 题解搜索</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="prism.css" rel="stylesheet">
    <script src="prism.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #9333ea;
            --light-bg: #f8fafc;
            --dark-bg: #0a0f1c;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        .dark-mode {
            --light-bg: #0a0f1c;
            --dark-bg: #000000;
            --card-bg: #1a2238;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }

        body {
            background: linear-gradient(135deg, var(--light-bg) 0%, #e2e8f0 100%);
            min-height: 100vh;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        body.dark-mode {
            background: var(--dark-bg);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .search-input {
            border-radius: 50px;
            padding: 0.8rem 1.5rem;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        .lang-badge {
            display: inline-block;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 50px;
            padding: 0.6rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .result-item {
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }

        pre[class*="language-"] {
            border-radius: 0.75rem;
            padding: 1.5rem;
            overflow-x: auto;
            position: relative;
            margin: 1rem 0;
            background: #1a1b26 !important;
        }

        /* 调整代码块样式以匹配主题 */
        .dark-mode pre[class*="language-"] {
            background: #2d2d3a !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(37, 99, 235, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-view,
        .code-view {
            transition: all 0.3s ease;
        }

        .code-view {
            display: none;
            opacity: 0;
            transform: translateY(20px);
        }

        .code-view.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .search-view.hidden {
            display: none;
            opacity: 0;
            transform: translateY(-20px);
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #e2e8f0;
        }

        .back-button:hover {
            background-color: var(--primary);
            color: white;
        }


        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p,
        span,
        div,
        input,
        button {
            color: var(--text-primary);
        }

        .bg-blue-100 {
            background-color: #dbeafe;
        }

        .text-blue-800 {
            color: #1e40af;
        }

        .bg-yellow-100 {
            background-color: #fef3c7;
        }

        .text-yellow-800 {
            color: #92400e;
        }

        .bg-red-100 {
            background-color: #fee2e2;
        }

        .text-red-800 {
            color: #991b1b;
        }

        .dark-mode .bg-blue-100 {
            background-color: #1e3a8a;
        }

        .dark-mode .text-blue-800 {
            color: #dbeafe;
        }

        .dark-mode .bg-yellow-100 {
            background-color: #713f12;
        }

        .dark-mode .text-yellow-800 {
            color: #fef3c7;
        }

        .dark-mode .bg-red-100 {
            background-color: #7f1d1d;
        }

        .dark-mode .text-red-800 {
            color: #fee2e2;
        }

        /* 复制按钮样式 */
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(31, 41, 55, 0.8);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }

        pre:hover .copy-btn {
            opacity: 1;
        }

        /* 来源标签样式 */
        .source-badge {
            display: inline-block;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .source-leetcode {
            background-color: #3b82f6;
            color: white;
        }

        .source-luogu {
            background-color: #10b981;
            color: white;
        }

        /* 筛选按钮样式 */
        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        .filter-btn:hover {
            opacity: 0.9;
        }

        .filter-btn.active {
            color: white;
        }

        .filter-btn.all.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: transparent;
        }

        .filter-btn.leetcode.active {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        .filter-btn.luogu.active {
            background-color: #10b981;
            border-color: #10b981;
        }

        /* 分页样式 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1.5rem;
            gap: 0.5rem;
        }

        .page-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover {
            background-color: #f1f5f9;
        }

        .page-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- 头部 -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-10">
            <div class="flex items-center mb-6 md:mb-0">
                <div class="bg-blue-600 text-white p-3 rounded-xl shadow-lg mr-4">
                    <i class="fas fa-code text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold">LeetCode 题解搜索</h1>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <div class="flex items-center">
                    <i class="fas fa-sun text-yellow-400 dark:text-gray-600 mr-2"></i>
                    <label class="theme-switch">
                        <input type="checkbox" id="themeToggle" aria-label="切换深色模式" />
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon text-gray-600 dark:text-yellow-400 ml-2"></i>
                </div>
            </div>
        </header>

        <!-- 搜索视图 -->
        <div class="search-view">
            <!-- 搜索区域 -->
            <div class="card p-6 mb-8">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input id="searchInput" type="text" placeholder="输入题号或题目名称搜索..."
                        class="w-full pl-12 pr-4 py-4 search-input" />
                    <div class="absolute right-2 top-2">
                        <span id="resultCount"
                            class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full hidden">0
                            结果</span>
                    </div>
                </div>
            </div>

            <!-- 筛选器 -->
            <div class="card p-4 mb-6">
                <div class="flex flex-wrap items-center gap-2">
                    <span class="text-sm font-medium mr-2">来源筛选:</span>
                    <button id="filter-all" class="filter-btn all active">全部</button>
                    <button id="filter-leetcode" class="filter-btn leetcode">LeetCode</button>
                    <button id="filter-luogu" class="filter-btn luogu">Luogu</button>
                </div>
            </div>

            <!-- 搜索结果 -->
            <div class="w-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">搜索结果</h2>
                    <span id="resultsCount" class="text-sm text-gray-500 dark:text-gray-400">0 个结果</span>
                </div>

                <div id="results" class="space-y-4">
                    <div class="text-center py-10">
                        <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400">输入关键词搜索题解</p>
                    </div>
                </div>

                <!-- 分页控件 -->
                <div id="pagination" class="pagination hidden">
                    <button id="prev-page" class="page-btn" aria-label="上一页">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div id="page-numbers" class="flex gap-1"></div>
                    <button id="next-page" class="page-btn" aria-label="下一页">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 代码视图 -->
        <div class="code-view">
            <div class="mb-6">
                <div class="back-button" id="backButton">
                    <i class="fas fa-arrow-left mr-2"></i> 返回搜索
                </div>
            </div>

            <div class="card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold" id="codeTitle">代码预览</h2>
                    <button id="copyButton" class="btn-primary">
                        <i class="far fa-copy mr-2"></i>复制代码
                    </button>
                </div>

                <div class="mb-4 flex items-center">
                    <span id="codeSource" class="source-badge mr-2"></span>
                    <span id="codeLang" class="lang-badge bg-blue-100 text-blue-800"></span>
                    <span id="codeSize" class="text-sm text-gray-500 dark:text-gray-400 ml-3"></span>
                </div>

                <div class="relative">
                    <pre id="code-pre"><code id="codeContent" class="language-none"></code></pre>
                    <div id="copySuccess"
                        class="absolute top-4 right-4 bg-green-500 text-white px-3 py-1 rounded-lg shadow-md opacity-0 transition-opacity">
                        已复制!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let indexData = [];
        let currentTheme = localStorage.getItem("theme") || "light";
        let currentRawCode = ""; // 存储原始代码用于复制
        let currentFilter = "all"; // 当前筛选器状态
        let currentPage = 1; // 当前页码
        const itemsPerPage = 10; // 每页显示的项目数

        // 初始化主题
        function initTheme() {
            if (currentTheme === "dark") {
                document.documentElement.classList.add("dark-mode");
                document.body.classList.add("dark-mode");
                document.getElementById("themeToggle").checked = true;
            } else {
                document.documentElement.classList.remove("dark-mode");
                document.body.classList.remove("dark-mode");
                document.getElementById("themeToggle").checked = false;
            }
        }

        // 切换主题
        function toggleTheme() {
            if (currentTheme === "light") {
                currentTheme = "dark";
                document.documentElement.classList.add("dark-mode");
                document.body.classList.add("dark-mode");
            } else {
                currentTheme = "light";
                document.documentElement.classList.remove("dark-mode");
                document.body.classList.remove("dark-mode");
            }
            localStorage.setItem("theme", currentTheme);
        }

        // 判断语言
        function detectLanguage(filename) {
            const ext = filename.split(".").pop().toLowerCase();
            const langMap = {
                cpp: "C++",
                cc: "C++",
                cxx: "C++",
                c: "C",
                py: "Python",
                java: "Java",
                js: "JavaScript",
                ts: "TypeScript",
                go: "Go",
                rs: "Rust",
                php: "PHP",
                rb: "Ruby",
                cs: "C#",
                swift: "Swift",
                kt: "Kotlin",
                scala: "Scala",
            };
            return langMap[ext] || ext.toUpperCase();
        }

        // 获取 Prism 语言标识符
        function getPrismLanguage(filename) {
            const ext = filename.split(".").pop().toLowerCase();
            const langMap = {
                cpp: "cpp",
                cc: "cpp",
                cxx: "cpp",
                c: "c",
                py: "python",
                java: "java",
                js: "javascript",
                ts: "typescript",
                go: "go",
                rs: "rust",
                php: "php",
                rb: "ruby",
                cs: "csharp",
                swift: "swift",
                kt: "kotlin",
                scala: "scala",
            };
            return langMap[ext] || "none";
        }

        // 获取语言颜色
        function getLanguageColor(lang) {
            const colors = {
                "C++": "bg-blue-100 text-blue-800",
                "C": "bg-blue-100 text-blue-800",
                Python: "bg-yellow-100 text-yellow-800",
                Java: "bg-red-100 text-red-800",
                JavaScript: "bg-yellow-100 text-yellow-800",
                TypeScript: "bg-blue-100 text-blue-800",
                Go: "bg-cyan-100 text-cyan-800",
                Rust: "bg-orange-100 text-orange-800",
                PHP: "bg-purple-100 text-purple-800",
                Ruby: "bg-red-100 text-red-800",
                "C#": "bg-green-100 text-green-800",
                Swift: "bg-orange-100 text-orange-800",
                Kotlin: "bg-purple-100 text-purple-800",
                Scala: "bg-red-100 text-red-800",
            };
            return colors[lang] || "bg-gray-100 text-gray-800";
        }

        // 获取来源颜色
        function getSourceColor(source) {
            if (source === "leetcode") {
                return "source-leetcode";
            } else if (source === "luogu") {
                return "source-luogu";
            }
            return "bg-gray-100 text-gray-800";
        }

        // 获取来源显示名称
        function getSourceDisplayName(source) {
            if (source === "leetcode") {
                return "LeetCode";
            } else if (source === "luogu") {
                return "Luogu";
            }
            return source;
        }


        // 加载索引
        async function loadIndex() {
            const loadingEl = document.getElementById("results");
            loadingEl.innerHTML = `
                <div class="text-center py-5">
                    <div class="loading mx-auto mb-3"></div>
                    <p class="text-gray-500 dark:text-gray-400">加载索引中...</p>
                </div>
            `;

            try {
                // 从同目录下的index.json加载数据
                const response = await fetch('./index.json');
                if (!response.ok) {
                    throw new Error('无法加载index.json文件');
                }
                indexData = await response.json();

                // 显示一些随机题目提示
                showRandomHints();
            } catch (err) {
                console.error("加载索引失败:", err);
                document.getElementById("results").innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-exclamation-triangle text-4xl text-yellow-400 mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400">加载索引失败，请刷新重试</p>
                        <p class="text-sm text-gray-400 mt-2">错误信息: ${err.message}</p>
                    </div>
                `;
            }
        }

        // 显示随机提示
        function showRandomHints() {
            const hints = [
                "尝试搜索题号或题目名称",
                "Keep Coding!",
            ];

            document.getElementById("results").innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-lightbulb text-2xl text-yellow-400 mb-3"></i>
                    <p class="text-gray-500 dark:text-gray-400">${hints[Math.floor(Math.random() * hints.length)]}</p>
                </div>
            `;
        }

        // 搜索功能
        function search(query) {
            query = query.trim().toLowerCase();
            if (!query) return [];

            return indexData.filter(
                (item) =>
                    (item.id.toLowerCase().includes(query) ||
                    item.title.toLowerCase().includes(query) ||
                    item.filename.toLowerCase().includes(query)) &&
                    (currentFilter === "all" || item.source === currentFilter)
            );
        }

        // 筛选功能
        function filterResults(source) {
            currentFilter = source;
            currentPage = 1; // 重置到第一页
            
            // 更新按钮状态
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (source === "all") {
                document.getElementById("filter-all").classList.add('active');
            } else if (source === "leetcode") {
                document.getElementById("filter-leetcode").classList.add('active');
            } else if (source === "luogu") {
                document.getElementById("filter-luogu").classList.add('active');
            }
            
            // 重新搜索并渲染结果
            const query = document.getElementById("searchInput").value;
            const results = search(query);
            renderResults(results, query);
        }

        // 排序结果
        function sortResults(results) {
            return results.sort((a, b) => {
                // 尝试提取数字进行排序
                const numA = parseInt(a.id.replace('P', ''));
                const numB = parseInt(b.id.replace('P', ''));
                
                // 如果都能提取到数字，则按数字排序
                if (!isNaN(numA) && !isNaN(numB)) {
                    return numA - numB;
                }
                
                // 否则按字符串排序
                return a.id.localeCompare(b.id);
            });
        }

        // 渲染分页控件
        function renderPagination(totalItems, currentPage, itemsPerPage) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationEl = document.getElementById("pagination");
            const pageNumbersEl = document.getElementById("page-numbers");
            
            // 如果只有一页或没有数据，隐藏分页控件
            if (totalPages <= 1) {
                paginationEl.classList.add("hidden");
                return;
            }
            
            paginationEl.classList.remove("hidden");
            
            // 清空页码按钮
            pageNumbersEl.innerHTML = '';
            
            // 计算要显示的页码范围
            const maxVisiblePages = 5; // 最多显示5个页码按钮
            let startPage, endPage;
            
            if (totalPages <= maxVisiblePages) {
                // 如果总页数小于等于最大显示页数，显示所有页码
                startPage = 1;
                endPage = totalPages;
            } else {
                // 计算显示的页码范围
                const halfVisible = Math.floor(maxVisiblePages / 2);
                
                if (currentPage <= halfVisible) {
                    // 当前页靠近开头
                    startPage = 1;
                    endPage = maxVisiblePages;
                } else if (currentPage + halfVisible >= totalPages) {
                    // 当前页靠近结尾
                    startPage = totalPages - maxVisiblePages + 1;
                    endPage = totalPages;
                } else {
                    // 当前页在中间
                    startPage = currentPage - halfVisible;
                    endPage = currentPage + halfVisible;
                }
            }
            
            // 添加第一页按钮（如果不是第一页且不在显示范围内）
            if (startPage > 1) {
                const firstPageBtn = document.createElement("button");
                firstPageBtn.className = `page-btn ${1 === currentPage ? 'active' : ''}`;
                firstPageBtn.textContent = '1';
                firstPageBtn.dataset.page = '1';
                pageNumbersEl.appendChild(firstPageBtn);
                
                // 添加省略号
                if (startPage > 2) {
                    const ellipsis = document.createElement("span");
                    ellipsis.className = "px-2 py-1 text-gray-500";
                    ellipsis.textContent = "...";
                    pageNumbersEl.appendChild(ellipsis);
                }
            }
            
            // 创建页码按钮
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement("button");
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.dataset.page = i;
                pageNumbersEl.appendChild(pageBtn);
            }
            
            // 添加最后一页按钮（如果不是最后一页且不在显示范围内）
            if (endPage < totalPages) {
                // 添加省略号
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement("span");
                    ellipsis.className = "px-2 py-1 text-gray-500";
                    ellipsis.textContent = "...";
                    pageNumbersEl.appendChild(ellipsis);
                }
                
                const lastPageBtn = document.createElement("button");
                lastPageBtn.className = `page-btn ${totalPages === currentPage ? 'active' : ''}`;
                lastPageBtn.textContent = totalPages;
                lastPageBtn.dataset.page = totalPages;
                pageNumbersEl.appendChild(lastPageBtn);
            }
            
            // 更新上一页/下一页按钮状态
            const prevBtn = document.getElementById("prev-page");
            const nextBtn = document.getElementById("next-page");
            
            prevBtn.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
            nextBtn.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
            
            // 绑定事件（只绑定一次）
            if (!prevBtn.dataset.bound) {
                prevBtn.addEventListener('click', handlePrevPage);
                prevBtn.dataset.bound = 'true';
            }
            
            if (!nextBtn.dataset.bound) {
                nextBtn.addEventListener('click', handleNextPage);
                nextBtn.dataset.bound = 'true';
            }
        }

        // 处理上一页按钮点击
        function handlePrevPage() {
            if (currentPage > 1) {
                currentPage--;
                const query = document.getElementById("searchInput").value;
                const results = search(query);
                renderResults(results, query);
            }
        }

        // 处理下一页按钮点击
        function handleNextPage() {
            const totalPages = Math.ceil(getFilteredResultsCount() / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                const query = document.getElementById("searchInput").value;
                const results = search(query);
                renderResults(results, query);
            }
        }

        // 获取当前筛选条件下的结果总数
        function getFilteredResultsCount() {
            const query = document.getElementById("searchInput").value;
            const results = search(query);
            return results.length;
        }

        // 绑定页码按钮事件
        function bindPageButtons() {
            document.querySelectorAll('.page-btn:not(#prev-page):not(#next-page)').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = parseInt(this.dataset.page);
                    if (!isNaN(page) && page !== currentPage) {
                        currentPage = page;
                        const query = document.getElementById("searchInput").value;
                        const results = search(query);
                        renderResults(results, query);
                    }
                });
            });
        }

        // 渲染搜索结果
        function renderResults(results, query) {
            const container = document.getElementById("results");
            const countEl = document.getElementById("resultsCount");

            results = sortResults(results);
            countEl.textContent = `${results.length} 个结果`;

            // 如果查询为空且是特定来源筛选，显示所有题目
            if (!query.trim() && currentFilter !== "all") {
                // 不显示随机提示，而是显示所有题目
            } else if (!query.trim() && currentFilter === "all") {
                showRandomHints();
                document.getElementById("pagination").classList.add("hidden");
                return;
            }

            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10 fade-in">
                        <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400">没有找到相关题目，尝试其他关键词</p>
                    </div>
                `;
                document.getElementById("pagination").classList.add("hidden");
                return;
            }

            // 计算分页数据
            const totalPages = Math.ceil(results.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, results.length);
            const paginatedResults = results.slice(startIndex, endIndex);

            container.innerHTML = "";

            paginatedResults.forEach((item) => {
                const lang = detectLanguage(item.filename);
                const langColor = getLanguageColor(lang);
                const sourceColor = getSourceColor(item.source);
                const sourceName = getSourceDisplayName(item.source);

                const div = document.createElement("div");
                div.className = "card p-4 result-item cursor-pointer fade-in";
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold">${item.id}. ${item.title}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${item.filename}</p>
                        </div>
                        <div class="flex items-center">
                            <span class="source-badge ${sourceColor}">${sourceName}</span>
                            <span class="lang-badge ${langColor}">${lang}</span>
                        </div>
                    </div>
                `;

                div.addEventListener("click", () => showCode(item));
                container.appendChild(div);
            });

            // 渲染分页控件
            renderPagination(results.length, currentPage, itemsPerPage);
            
            // 绑定页码按钮事件
            setTimeout(bindPageButtons, 0);
        }

        // 显示代码视图
        async function showCode(item) {
            // 切换到代码视图
            document.querySelector('.search-view').classList.add('hidden');
            document.querySelector('.code-view').classList.add('active');

            // 设置代码标题
            document.getElementById("codeTitle").textContent = `${item.id}. ${item.title}`;

            // 设置来源标签
            const sourceColor = getSourceColor(item.source);
            const sourceName = getSourceDisplayName(item.source);
            document.getElementById("codeSource").className = `source-badge ${sourceColor}`;
            document.getElementById("codeSource").textContent = sourceName;

            // 设置代码内容
            const codeContent = document.getElementById("codeContent");
            const preElement = document.getElementById("code-pre");
            codeContent.textContent = "加载中...";

            try {
                const response = await fetch(item.raw_url);
                if (!response.ok) throw new Error("无法获取代码");

                const code = await response.text();
                currentRawCode = code; // 保存原始代码用于复制

                // 更新代码大小
                const sizeKB = (new TextEncoder().encode(code).length / 1024).toFixed(1);
                document.getElementById("codeSize").textContent = `${sizeKB} KB`;

                // 获取 prism 语言
                const prismLang = getPrismLanguage(item.filename);
                
                // 获取显示语言
                const displayLang = detectLanguage(item.filename);
                
                // 清除之前的类
                preElement.className = '';
                codeContent.className = '';

                // 设置新的语言类
                preElement.classList.add(`language-${prismLang}`);
                codeContent.classList.add(`language-${prismLang}`);

                // 更新语言标签显示
                const langColor = getLanguageColor(displayLang);
                const codeLangElement = document.getElementById("codeLang");
                codeLangElement.className = `lang-badge ${langColor}`;
                codeLangElement.textContent = displayLang;

                // 设置代码内容
                codeContent.textContent = code;

                // 使用 Prism 高亮
                if (typeof Prism !== 'undefined') {
                    Prism.highlightElement(codeContent);
                }

            } catch (error) {
                codeContent.textContent = `// 无法加载代码，请检查网络连接或稍后重试\n// 错误信息: ${error.message}`;
                console.error("加载代码失败:", error);
            }
        }

        // 返回搜索视图
        function backToSearch() {
            document.querySelector('.code-view').classList.remove('active');
            setTimeout(() => {
                document.querySelector('.search-view').classList.remove('hidden');
            }, 300);
        }

        // 复制代码功能
        function copyCodeToClipboard() {
            navigator.clipboard.writeText(currentRawCode).then(() => {
                // 显示复制成功提示
                const copySuccess = document.getElementById("copySuccess");
                copySuccess.classList.remove("opacity-0");

                setTimeout(() => {
                    copySuccess.classList.add("opacity-0");
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // 初始化
        document.addEventListener("DOMContentLoaded", function () {
            // 初始化主题
            initTheme();

            // 主题切换事件
            document.getElementById("themeToggle").addEventListener("change", toggleTheme);

            // 搜索输入事件
            let searchTimeout;
            document.getElementById("searchInput").addEventListener("input", (e) => {
                clearTimeout(searchTimeout);
                currentPage = 1; // 搜索时重置到第一页
                searchTimeout = setTimeout(() => {
                    const query = e.target.value;
                    const results = search(query);
                    renderResults(results, query);
                }, 300);
            });

            // 筛选器事件
            document.getElementById("filter-all").addEventListener("click", () => filterResults("all"));
            document.getElementById("filter-leetcode").addEventListener("click", () => filterResults("leetcode"));
            document.getElementById("filter-luogu").addEventListener("click", () => filterResults("luogu"));

            // 复制按钮事件
            document.getElementById("copyButton").addEventListener("click", copyCodeToClipboard);

            // 返回按钮事件
            document.getElementById("backButton").addEventListener("click", backToSearch);

            // 加载索引数据
            loadIndex();
        });
    </script>
</body>

</html>